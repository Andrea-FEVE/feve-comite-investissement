<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Projects</title>
  <style>
  body {
    font-family: system-ui;
    background: #f7f8fa;
    padding: 40px;
  }

  h1 {
    margin-bottom: 24px;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 20px;
  }

  .card {
    background: white;
    border-radius: 8px;
    overflow: hidden;
    text-decoration: none;
    color: black;
    box-shadow: 0 1px 4px rgba(0,0,0,.08);
    transition: transform .1s ease, box-shadow .1s ease;
  }

  .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,.12);
  }

  .card img {
    width: 100%;
    height: 160px;
    object-fit: cover;
    background: #ddd;
  }

  .card-content {
    padding: 12px;
  }

  .card-title {
    font-weight: 600;
    margin-bottom: 4px;
  }

  .card-dept {
    font-size: 14px;
    color: #666;
  }
</style>

</head>
<body>

<script>
  fetch("/api/auth")
    .then(r => r.json())
    .then(a => { if (!a.authenticated) location.href="/login.html"; });
</script>

<h1>Projects</h1>
  <label for="dateFilter">Filter by date:</label>
<select id="dateFilter">
  <option value="">All dates</option>
</select>

<div id="projects" class="grid"></div>

<script>
  let allProjects = [];

  function renderProjects(projects) {
    const grid = document.getElementById("projects");
    grid.innerHTML = "";

    projects.forEach(p => {
      const a = document.createElement("a");
      a.href = `project.html?slug=${p.slug}`;
      a.className = "card";

      a.innerHTML = `
        ${p.photo
          ? `<img src="${p.photo}" alt="">`
          : `<div style="height:160px;background:#ccc"></div>`}
        <div class="card-content">
          <div class="card-title">${p.name}</div>
          <div class="card-dept">${p.department}</div>
          <div class="card-dept">${p.dateComite}</div>
        </div>
      `;

      grid.appendChild(a);
    });
  }

  fetch("/api/projects")
    .then(r => r.json())
    .then(projects => {
      allProjects = projects;

      // Populate date dropdown
      const dates = [...new Set(projects.map(p => p.dateComite))].sort();
      const select = document.getElementById("dateFilter");

      dates.forEach(date => {
        const option = document.createElement("option");
        option.value = date;
        option.textContent = date;
        select.appendChild(option);
      });

      renderProjects(projects);
    });

  document.getElementById("dateFilter").addEventListener("change", e => {
    const selectedDate = e.target.value;

    if (!selectedDate) {
      renderProjects(allProjects);
    } else {
      renderProjects(
        allProjects.filter(p => p.dateComite === selectedDate)
      );
    }
  });
</script>



</body>
</html>
